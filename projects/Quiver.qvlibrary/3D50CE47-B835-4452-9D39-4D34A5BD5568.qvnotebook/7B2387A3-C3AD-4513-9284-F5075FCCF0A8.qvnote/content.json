{
  "title": "将一个类作为单例",
  "cells": [
    {
      "type": "text",
      "data": "<pre dir=\"ltr\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c\" lang=\"en\" style=\"border: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word; margin-top: 0px; margin-bottom: 0px; color: rgb(0, 0, 0); font-size: 14.1728px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span class=\"line\"><span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">import</span> <span class=\"ID\">functools</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_2\"></span><span class=\"anchor\" id=\"line-2-37\"></span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_3\"></span><span class=\"anchor\" id=\"line-3-37\"></span><span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">def</span> <span class=\"ID\">singleton</span>(<span class=\"ID\">cls</span>):</span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_4\"></span><span class=\"anchor\" id=\"line-4-36\"></span>    <span class=\"String\" style=\"color: rgb(0, 64, 128);\">''' Use class as singleton. '''</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_5\"></span><span class=\"anchor\" id=\"line-5-36\"></span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_6\"></span><span class=\"anchor\" id=\"line-6-36\"></span>    <span class=\"ID\">cls</span>.<span class=\"ID\">__new_original__</span> = <span class=\"ID\">cls</span>.<span class=\"ID\">__new__</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_7\"></span><span class=\"anchor\" id=\"line-7-36\"></span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_8\"></span><span class=\"anchor\" id=\"line-8-35\"></span>    <span class=\"ID\">@functools.wraps</span>(<span class=\"ID\">cls</span>.<span class=\"ID\">__new__</span>)</span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_9\"></span><span class=\"anchor\" id=\"line-9-35\"></span>    <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">def</span> <span class=\"ID\">singleton_new</span>(<span class=\"ID\">cls</span>, *<span class=\"ID\">args</span>, **<span class=\"ID\">kw</span>):</span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_10\"></span><span class=\"anchor\" id=\"line-10-35\"></span>        <span class=\"ID\">it</span> =  <span class=\"ID\">cls</span>.<span class=\"ID\">__dict__</span>.<span class=\"ID\">get</span>(<span class=\"String\" style=\"color: rgb(0, 64, 128);\">'</span><span class=\"String\" style=\"color: rgb(0, 64, 128);\">__it__</span><span class=\"String\" style=\"color: rgb(0, 64, 128);\">'</span>)</span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_11\"></span><span class=\"anchor\" id=\"line-11-33\"></span>        <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">if</span> <span class=\"ID\">it</span> <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">is</span> <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">not</span> <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">None</span>:</span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_12\"></span><span class=\"anchor\" id=\"line-12-33\"></span>            <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">return</span> <span class=\"ID\">it</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_13\"></span><span class=\"anchor\" id=\"line-13-32\"></span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_14\"></span><span class=\"anchor\" id=\"line-14-32\"></span>        <span class=\"ID\">cls</span>.<span class=\"ID\">__it__</span> = <span class=\"ID\">it</span> = <span class=\"ID\">cls</span>.<span class=\"ID\">__new_original__</span>(<span class=\"ID\">cls</span>, *<span class=\"ID\">args</span>, **<span class=\"ID\">kw</span>)</span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_15\"></span><span class=\"anchor\" id=\"line-15-32\"></span>        <span class=\"ID\">it</span>.<span class=\"ID\">__init_original__</span>(*<span class=\"ID\">args</span>, **<span class=\"ID\">kw</span>)</span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_16\"></span><span class=\"anchor\" id=\"line-16-32\"></span>        <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">return</span> <span class=\"ID\">it</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_17\"></span><span class=\"anchor\" id=\"line-17-31\"></span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_18\"></span><span class=\"anchor\" id=\"line-18-31\"></span>    <span class=\"ID\">cls</span>.<span class=\"ID\">__new__</span> = <span class=\"ID\">singleton_new</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_19\"></span><span class=\"anchor\" id=\"line-19-30\"></span>    <span class=\"ID\">cls</span>.<span class=\"ID\">__init_original__</span> = <span class=\"ID\">cls</span>.<span class=\"ID\">__init__</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_20\"></span><span class=\"anchor\" id=\"line-20-29\"></span>    <span class=\"ID\">cls</span>.<span class=\"ID\">__init__</span> = <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">object</span>.<span class=\"ID\">__init__</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_21\"></span><span class=\"anchor\" id=\"line-21-29\"></span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_22\"></span><span class=\"anchor\" id=\"line-22-29\"></span>    <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">return</span> <span class=\"ID\">cls</span></span></pre>"
    },
    {
      "type": "text",
      "data": "<pre dir=\"ltr\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c\" lang=\"en\" style=\"border: none; background-color: rgb(243, 245, 247); padding: 10pt; font-family: courier, monospace; white-space: pre-wrap; overflow-wrap: break-word; margin-top: 0px; margin-bottom: 0px; color: rgb(0, 0, 0); font-size: 14.1728px; font-variant-ligatures: normal; orphans: 2; widows: 2;\"><span class=\"line\"><span class=\"Comment\" style=\"color: rgb(0, 128, 0);\">#</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_25\"></span><span class=\"anchor\" id=\"line-25-26\"></span><span class=\"Comment\" style=\"color: rgb(0, 128, 0);\"># Sample use:</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_26\"></span><span class=\"anchor\" id=\"line-26-24\"></span><span class=\"Comment\" style=\"color: rgb(0, 128, 0);\">#</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_27\"></span><span class=\"anchor\" id=\"line-27-21\"></span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_28\"></span><span class=\"anchor\" id=\"line-28-19\"></span><span class=\"ID\">@singleton</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_29\"></span><span class=\"anchor\" id=\"line-29-18\"></span><span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">class</span> <span class=\"ID\">Foo</span>:</span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_30\"></span><span class=\"anchor\" id=\"line-30-16\"></span>    <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">def</span> <span class=\"ID\">__new__</span>(<span class=\"ID\">cls</span>):</span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_31\"></span><span class=\"anchor\" id=\"line-31-15\"></span>        <span class=\"ID\">cls</span>.<span class=\"ID\">x</span> = <span class=\"Number\" style=\"color: rgb(0, 128, 192);\">10</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_32\"></span><span class=\"anchor\" id=\"line-32-15\"></span>        <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">return</span> <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">object</span>.<span class=\"ID\">__new__</span>(<span class=\"ID\">cls</span>)</span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_33\"></span><span class=\"anchor\" id=\"line-33-15\"></span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_34\"></span><span class=\"anchor\" id=\"line-34-14\"></span>    <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">def</span> <span class=\"ID\">__init__</span>(<span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">self</span>):</span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_35\"></span><span class=\"anchor\" id=\"line-35-14\"></span>        <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">assert</span> <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">self</span>.<span class=\"ID\">x</span> == <span class=\"Number\" style=\"color: rgb(0, 128, 192);\">10</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_36\"></span><span class=\"anchor\" id=\"line-36-14\"></span>        <span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">self</span>.<span class=\"ID\">x</span> = <span class=\"Number\" style=\"color: rgb(0, 128, 192);\">15</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_37\"></span><span class=\"anchor\" id=\"line-37-14\"></span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_38\"></span><span class=\"anchor\" id=\"line-38-13\"></span><span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">assert</span> <span class=\"ID\">Foo</span>().<span class=\"ID\">x</span> == <span class=\"Number\" style=\"color: rgb(0, 128, 192);\">15</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_39\"></span><span class=\"anchor\" id=\"line-39-13\"></span><span class=\"ID\">Foo</span>().<span class=\"ID\">x</span> = <span class=\"Number\" style=\"color: rgb(0, 128, 192);\">20</span></span>\n<span class=\"line\"><span class=\"LineAnchor\" id=\"CA-0c3a436acba24849ab4004c16b8868d60d69653c_40\"></span><span class=\"anchor\" id=\"line-40-13\"></span><span class=\"ResWord\" style=\"color: rgb(160, 0, 0);\">assert</span> <span class=\"ID\">Foo</span>().<span class=\"ID\">x</span> == <span class=\"Number\" style=\"color: rgb(0, 128, 192);\">20</span></span></pre>"
    }
  ]
}